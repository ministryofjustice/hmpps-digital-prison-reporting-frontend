
{%- from "moj/components/ticket-panel/macro.njk" import mojTicketPanel -%}

{% macro dprDownloadMessage(reportData) %}
  {% set reportId = reportData.reportId %}
  {% set id = reportData.id %}
  {% set loadType = reportData.loadType %}
  {% set dataProductDefinitionsPath = reportData.dataProductDefinitionsPath %}

  {% if loadType === 'async' %}
    {% set tableId = reportData.tableId %}
    {% set feedbackFormHref = "/download/"+ reportId + "/" + id + "/" + tableId + "/feedback"  %}
  {% else %}
    {% set feedbackFormHref = "/download/"+ reportId + "/" + id + "/feedback"  %}
  {% endif %}

  {% if dataProductDefinitionsPath %}
    {% set feedbackFormHref = feedbackFormHref + '?dataProductDefinitionsPath=' + dataProductDefinitionsPath  %}
  {% endif %}


  {% set html %}
    <h2 class="govuk-heading-m">You do not have permission to download this report</h2>
    <a href="{{ feedbackFormHref }}" class="govuk-link govuk-link--no-visited-state govuk-!-margin-bottom-1">
      Complete a request form to enable download
    </a> (takes 1 minute)
  {% endset %}

  <div id="dpr-download-message" class="dpr-download-message--hidden govuk-!-margin-bottom-6" data-dpr-module='download-message'>
    {{ mojTicketPanel({
      attributes: {
        'aria-label': 'Sub navigation 1'
      },
      items: [{
        html: html,
        attributes: {
          'aria-label': 'Section 1'
        },
        classes: 'moj-ticket-panel__content--blue'
      }]
    }) }}
  </div>
{% endmacro %}
