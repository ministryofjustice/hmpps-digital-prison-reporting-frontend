{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "../report-summary-table/view.njk" import dprReportSummary %}

{% from "./report-data-table/view.njk" import dprDataTable %}
{% from "./parent-child-template/view.njk" import dprParentChildTemplate %}

{% macro dprReportSection(renderData, template, classification) %}
  {% set sections = renderData.sections %}

  <div id="dpr-report-sections">
    {% for section in sections %}
      {% set sectionTitle = section.title %}
      {% set sectionCount = section.count %}
      {% set data = section.data %}
      {% set summaries = section.summaries %}
      {% if sectionTitle %}
        {% set sectionLabelId = "section-title-" + loop.index %}
      {% endif %}

      <div 
        id="dpr-{{ template }}-section-{{ loop.index }}" 
        class="dpr-{{ template }}-section dpr-report-section"  
        {% if sectionLabelId %} aria-labelledby="{{ sectionLabelId }}" {% endif %}
      >
      
        {% if sectionTitle %}
        <div class="dpr-report-section__title">
          <h2 id="{{ sectionLabelId }}" class="govuk-heading-m">{{ sectionTitle }}
            {% if template !== 'summary-section' %}
            <span class="govuk-caption-m">{{ sectionCount }} results</span>
            {% endif %}
          </h2>
        </div>
        {% endif %}

        {# section header summary tables #}
        {{ dprReportSummary(summaries, 'section-header') }}

        {# report template #}
        {% if template === 'parent-child' or template === 'parent-child-section' %}

          {{ dprParentChildTemplate(data, classification, template, sectionLabelId or 'dpr-report-name') }}

        {% elif template !== 'summary-section' %}

          <div id="dpr-{{ template }}-section-data-{{ loop.index }}" class="dpr-{{ template }}-section__data">
            {{ dprDataTable(data, classification, template, sectionLabelId or 'dpr-report-name', loop.index) }}
          </div>

        {% endif %}

        {# section footer summary tables #}
        {{ dprReportSummary(summaries, 'section-footer') }} 

      </div>
    {% endfor %}
  </div>
{% endmacro %}
