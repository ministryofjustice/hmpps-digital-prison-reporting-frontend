{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "../parent-child/view.njk" import dprParentChildTemplate %}
{% from "../../report-summary-table/view.njk" import dprReportSummary %}

{% macro dprReportSection(renderData, template, classification) %}
  {% set sections = renderData.sections %}

  <div id="dpr-{{ template }}-template">
    {% for section in sections %}
      <div id="dpr-{{ template }}-section-{{ loop.index }}" class="dpr-{{ template }}-section dpr-template__section">
        {% set sectionTitle = section.title %}
        {% set sectionCount = section.count %}
        {% set data = section.data %}
        {% set summaries = section.summaries %}

        {% if sectionTitle %}
        <h2 class="govuk-heading-m">{{ sectionTitle }} 
        <span class="govuk-caption-m">{{ sectionCount }} results</span></h2>
        {% endif %}

        {# SECTION HEADER SUMMARIES #}
        {{ dprReportSummary(summaries, 'section-header') }}

        {# TEMPLATES #}
        {% if template === 'parent-child' or template === 'parent-child-section' %}

          {{ dprParentChildTemplate(data, classification) }}

        {% else %}

          <div id="dpr-{{ template }}-section-data-{{ loop.index }}" class="dpr-{{ template }}-section-data">
            {{ govukTable({
              head: data.head,
              rows: data.rows,
              attributes: { 
                'data-classification': classification
              }
            }) }}
          </div>

        {% endif %}

        {# SECTION FOOTER SUMMARIES #}
        {{ dprReportSummary(summaries, 'section-footer') }} 

      </div>
    {% endfor %}
  </div>
{% endmacro %}
