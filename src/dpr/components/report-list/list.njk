{% extends layoutTemplate %}

{% from "moj/components/button-menu/macro.njk" import mojButtonMenu -%}
{% from "../data-table/view.njk" import dprDataTable %}
{% from "../filters/view.njk" import dprFilters %}
{% from "../dropdown-button/view.njk"    import dprDropdownButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% set pageTitle = applicationName + " - " + title %}
{% set mainClasses = "app-container govuk-body" %}
{% set urlWithNoFilters = dataTableOptions.currentQueryParams | createUrlForParameters(null) %}

{% set selectedFilters = [{
  text: 'Reset filter',
  href: urlWithNoFilters,
  classes: 'govuk-button--secondary'
}].concat(filterOptions.selectedFilters) %}

{% set actions = [] %}
{% if (dataTableOptions.printable) %}
  {% set printAttributes = {
    'onclick': 'window.print()'
  } %}
{% else %}
  {% set printAttributes = {
    'disabled': 'true'
  } %}
{% endif %}

{% set printAction = {
  text: 'Print displayed results',
  attributes: printAttributes,
  classes: 'filter-summary-controls'
} %}
{% set actions = (actions.push(printAction), actions) %}

{% set subject = title | urlencode %}
{% set body = (dataTableOptions.url) | urlencode %}
{% set shareOptions = {
  title: "Share:",
  items: [
    {
      text: 'Copy URL',
      attributes: {
        'onclick': 'navigator.clipboard.writeText(window.location)'
      },
      classes: 'filter-summary-controls'
    },
    {
      text: 'Email',
      href: 'mailto:?subject=' + subject + '&body=' + body,
      classes: 'filter-summary-controls'
    }
  ]
} %}

{% block content %}
  <div class="govuk-grid-row">
    {{ dataTableOptions.url }}
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-m">{{ title }}</h1>
    </div>
    <div class="govuk-grid-column-one-third">
      <div class="dpr-actions">
        {{ dprDropdownButton({
          id: "actions",
          text: "Actions",
          classes: "",
          attributes: {},
          items: actions,
          groups: [ shareOptions ]
        }) }}
      </div>
    </div>
  </div>

  {% if warnings.noDataAvailable %}
    {{ govukErrorSummary({
      titleText: 'No data available',
      errorList: [
        {
          text: warnings.noDataAvailable
        }
      ]
    }) }}
  {% endif %}

  <div class="moj-filter-layout">
    <div class="moj-filter-layout__filter">
      {{ dprFilters(
        filterOptions.filters,
        urlWithNoFilters
      ) }}
    </div>
    <div class="moj-filter-layout__content">
      <div class="moj-action-bar">
        <div id="filter-bar" class="moj-button-menu"></div>
        {{ mojButtonMenu({
          items: selectedFilters
        }) }}
      </div>
      <div class="moj-scrollable-pane">
        {{ dprDataTable(
          dataTableOptions.head,
          dataTableOptions.rows,
          dataTableOptions.count,
          dataTableOptions.currentQueryParams,
          dataTableOptions.classification
        ) }}
      </div>
    </div>
  </div>

{% endblock %}